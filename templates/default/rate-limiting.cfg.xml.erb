<?xml version="1.0" encoding="UTF-8"?>

<!-- http://wiki.openrepose.org/display/REPOSE/Rate+Limiting+Filter -->
<rate-limiting xmlns="http://docs.openrepose.org/repose/rate-limiting/v1.0">
    <!--
        Defines an endpoint with a matching regex to bind GET requests for
        returning live rate limiting information.
    -->
    <request-endpoint uri-regex="<%= @uri_regex %>" include-absolute-limits="<%= @include_absolute_limits %>"/>

    <global-limit-group>
        <limit id="<%= @global_limit_id %>" uri="<%= @global_limit_uri %>" uri-regex="<%= @global_limit_uri_regex %>" value="<%= @global_limit_value %>" unit="<%= @global_limit_unit %>"/>
    </global-limit-group>

    <% @limit_groups.each do |limit_group| %>
    <!-- Limits for <%= limit_group['id'] %> -->
    <limit-group id="<%= limit_group['id'] %>" groups="<%= limit_group['groups'] %>" default="<%= limit_group['default'] %>">
        <% limit_group['limits'].each do |limit| %>
        <limit id="<%= limit['id'] %>" uri="<%= limit['uri'] %>" uri-regex="<%= limit['uri-regex'] %>" http-methods="<%= limit['http-methods'] %>" unit="<%= limit['unit'] %>" value="<%= limit['value'] %>" />
        <% end %>
    </limit-group>

    <% end %>
</rate-limiting>




    <!-- Limits for all other requests -->
    <limit-group id="limited" groups="limited" default="true">
        <limit id="all" uri="*" uri-regex="/.*" http-methods="POST PUT GET DELETE" unit="MINUTE" value="10"/>
    </limit-group>

    <!-- Limits for WhiteListed IPs -->
    <limit-group id="unlimited" groups="unlimited" default="false"/>

</rate-limiting>

